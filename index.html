<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oráculo Tecnomante: Frater Markarios</title>
    <style>
        #modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.98); display: flex; align-items: center; justify-content: center; z-index: 1000;
        }
        #modal-content {
            background: #000; border: 1px solid #00d4ff; padding: 35px;
            max-width: 480px; text-align: center; box-shadow: 0 0 40px #00d4ff33;
            line-height: 1.5;
        }
        #intento-input {
            width: 100%; padding: 12px; background: #0a0a0a; border: 1px solid #ff00ff;
            color: #00d4ff; font-family: monospace; margin: 15px 0; text-align: center; outline: none;
            box-sizing: border-box;
        }
        body { 
            background: #020202; color: #00d4ff; font-family: 'Courier New', monospace; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            min-height: 100vh; margin: 0; padding: 10px; box-sizing: border-box;
            padding-bottom: 60px; /* Espaço para o footer não sobrepor */
        }
        #canvas { 
            border: 1px solid #00d4ff; background: #000; 
            box-shadow: 0 0 25px #00d4ff22; max-width: 100%; height: auto;
        }
        #data-panel {
            margin-top: 20px; width: 400px; max-width: 100%;
            display: grid; grid-template-columns: 1fr 1fr; gap: 8px;
            font-size: 0.7rem; border: 1px solid #333; padding: 15px; background: rgba(5, 5, 5, 0.9);
            box-sizing: border-box;
        }
        .data-header { grid-column: span 2; color: #ff00ff; border-bottom: 1px solid #333; margin-bottom: 5px; padding-bottom: 3px; font-weight: bold; }
        .data-item { color: #00d4ff; opacity: 0.9; }
        .data-item span { color: #fff; font-weight: bold; }
        .controls { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; justify-content: center; }
        
        button { 
            background: transparent; color: #00d4ff; border: 1px solid #00d4ff; 
            padding: 10px 20px; cursor: pointer; text-transform: uppercase; font-size: 0.8rem;
        }
        button:hover { background: #00d4ff; color: #000; }
        .save-btn { border-color: #ff00ff; color: #ff00ff; }
        
        /* FOOTER TECNOMÂNTICO */
        footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.9);
            border-top: 1px solid #00d4ff44;
            padding: 10px 0;
            text-align: center;
            font-size: 0.7rem;
            letter-spacing: 2px;
            color: #00d4ff;
            text-shadow: 0 0 5px #00d4ff88;
        }
        .footer-glitch { color: #ff00ff; }

        .instrucao { font-size: 0.8rem; color: #00d4ff; margin-bottom: 10px; text-align: left; }
    </style>
</head>
<body>

    <div id="modal-overlay">
        <div id="modal-content">
            <h3 style="color: #ff00ff; letter-spacing: 5px; margin-bottom: 20px;">PROTOCOLO DE ATIVAÇÃO</h3>
            
            <div class="instrucao">
                • <b>O SIGILO:</b> Criado através da fusão da sua VONTADE com as variáveis ESPAÇO-TEMPORAIS do ambiente local.<br><br>
                • <b>REQUISITO:</b> Para que o oráculo colha a entropia do clima (Espaço), você deve <b>autorizar a geolocalização</b> quando solicitado pelo navegador.<br><br>
                • <b>INTENTO:</b> Digite seu desejo abaixo para integrá-lo à geometria sagrada.
            </div>

            <input type="text" id="intento-input" placeholder="Digite seu intento aqui..." autocomplete="off">
            
            <button onclick="fecharModal()">Consagrar e Iniciar</button>
        </div>
    </div>

    <h2 id="status" style="font-size: 1rem; margin-bottom: 15px; height: 1.2em; text-transform: uppercase;">Aguardando Operador...</h2>
    
    <canvas id="canvas" width="400" height="400"></canvas>

    <div id="data-panel">
        <div class="data-header">MÉTRICAS DA CANALIZAÇÃO</div>
        <div class="data-item">INTENTO_SEED: <span id="val-intento">---</span></div>
        <div class="data-item">CIDADE: <span id="val-city">---</span></div>
        <div class="data-item">TEMPERATURA: <span id="val-temp">---</span></div>
        <div class="data-item">UMIDADE: <span id="val-hum">---</span></div>
        <div class="data-item">VEL_VENTO: <span id="val-wind">---</span></div>
        <div class="data-item">COORD: <span id="val-coord">---</span></div>
        <div class="data-item">TEMPO_HASH: <span id="val-time-hash">---</span></div>
        <div class="data-item">TIMESTAMP: <span id="val-entropy">---</span></div>
    </div>
    
    <div class="controls">
        <button onclick="iniciarCanalizacao()">Recanalizar Fluxo</button>
        <button class="save-btn" onclick="saveSigil()">Consagrar Imagem</button>
    </div>

    <footer>
        <span class="footer-glitch">[</span> DESENVOLVIDO POR FRATER MARKARIOS <span class="footer-glitch">]</span> &copy; 2026
    </footer>

    <script>
        const API_KEY = '205dfbe3470e81f71e2b9f2f6a46443d'; 
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let intentoGlobal = "";

        function fecharModal() {
            intentoGlobal = document.getElementById('intento-input').value || "CAOS";
            document.getElementById('modal-overlay').style.display = 'none';
            iniciarCanalizacao();
        }

        function iniciarCanalizacao() {
            document.getElementById('status').innerText = "COLHENDO ENTROPIA ESPAÇO-TEMPORAL...";
            navigator.geolocation.getCurrentPosition(pos => {
                const lat = pos.coords.latitude;
                const lon = pos.coords.longitude;
                fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric`)
                .then(r => r.json()).then(data => drawSigil(data, lat, lon))
                .catch(() => { document.getElementById('status').innerText = "ERRO NA API"; });
            }, () => { 
                document.getElementById('status').innerText = "GPS BLOQUEADO";
                alert("O ritual falhou: A geolocalização é necessária para acessar as variáveis de Espaço.");
            });
        }

        function drawSigil(data, lat, lon) {
            const temp = data.main.temp;
            const humidity = data.main.humidity;
            const wind = data.wind.speed || 1;
            const city = data.name;
            const agora = new Date();
            
            const ms = agora.getMilliseconds();
            const seg = agora.getSeconds();
            const min = agora.getMinutes();
            const hora = agora.getHours();
            const entropy = agora.getTime();

            let intentSeed = 0;
            for(let i=0; i<intentoGlobal.length; i++) intentSeed += intentoGlobal.charCodeAt(i);

            document.getElementById('val-intento').innerText = intentSeed;
            document.getElementById('val-city').innerText = city.toUpperCase();
            document.getElementById('val-temp').innerText = temp + "°C";
            document.getElementById('val-hum').innerText = humidity + "%";
            document.getElementById('val-wind').innerText = wind + "m/s";
            document.getElementById('val-coord').innerText = `${lat.toFixed(2)},${lon.toFixed(2)}`;
            document.getElementById('val-time-hash').innerText = `${hora}${min}${seg}${ms}`;
            document.getElementById('val-entropy').innerText = entropy;
            document.getElementById('status').innerText = "SIGILO CONSAGRADO";

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const hue = (200 - (temp * 3)) + (ms / 10);
            ctx.strokeStyle = `hsl(${hue}, 100%, 50%)`;
            ctx.shadowBlur = 20; ctx.shadowColor = ctx.strokeStyle;
            
            let steps = Math.max(10, Math.floor((humidity/3) + intentoGlobal.length));
            let points = [];
            const chaosSeed = (seg * 1000) + ms + intentSeed;

            for (let i = 0; i < steps; i++) {
                let angle = (i / steps) * Math.PI * 2;
                let harmonic = Math.sin(i * wind + (chaosSeed / 500)) * 75;
                let r = 100 + harmonic;
                points.push({ x: 200 + Math.cos(angle) * r, y: 200 + Math.sin(angle) * r });
            }

            ctx.beginPath();
            ctx.lineWidth = 1.3;
            for (let i = 0; i < points.length; i++) {
                let next = (i + 1) % steps;
                let jumpFactor = (min % 2 === 0) ? 3 : 2;
                let far = (i + Math.floor(steps / jumpFactor)) % steps;
                
                ctx.moveTo(points[i].x, points[i].y);
                ctx.lineTo(points[next].x, points[next].y);
                ctx.moveTo(points[i].x, points[i].y);
                ctx.lineTo(points[far].x, points[far].y);
                
                ctx.fillStyle = ctx.strokeStyle;
                ctx.fillRect(points[i].x - 1.5, points[i].y - 1.5, 3, 3);
            }
            ctx.stroke();

            ctx.setLineDash([seg % 8, 12]);
            ctx.beginPath(); ctx.arc(200, 200, 185, 0, Math.PI * 2); ctx.stroke();
            ctx.setLineDash([]);
            
            ctx.shadowBlur = 0; ctx.fillStyle = "#ffffff11"; ctx.font = "7px monospace";
            ctx.fillText(`FRATER MARKARIOS | ${city.toUpperCase()} | ${entropy}`, 100, 395);
        }

        function saveSigil() {
            const link = document.createElement('a');
            const ts = new Date().getTime();
            link.download = `sigilo-${intentoGlobal.substring(0,8)}-${ts}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }
    </script>
</body>
</html>
